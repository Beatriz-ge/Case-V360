<div class="page">
  <div class="card">

    <h1 class="title"><%= @list.title %></h1>

    <% if flash[:notice] %>
      <div class="notice">
        <%= flash[:notice] %>
      </div>
    <% end %>

    <% if flash[:alert] %>
      <div class="alert">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <%= form_with model: [@list, @task], local: true, class: "task-form" do |f| %>

      <div class="form-group">
        <%= f.label :title, "Nova Tarefa", class: "subtitle" %>

        <% if @task&.errors&.any? %>
          <div class="field-error">
            <%= @task.errors[:title].first %>
          </div>
        <% end %>

        <%= f.text_field :title, class: "input", required: true %>
      </div>

      <div class="form-actions">
        <%= f.submit "Adicionar", class: "btn primary" %>
      </div>

    <% end %>

    <hr>

    <h2 class="subtitle">Minhas Tarefas</h2>

    <div class="task-summary">
      <p>Total de tarefas: <%= @total_tasks %></p>
      <p>Tarefas pendentes: <%= @pending_tasks %></p>
      <p>Tarefas concluídas: <%= @completed_tasks %></p>

      <div class="progress-bar">
        <div class="progress-bar-fill" style="width: <%= @progress %>%"></div>
      </div>
      <div class="progress-text">Progresso: <%= @progress %>%</div>
    </div>

    <ul class="task-list">
      <% @list.tasks.each do |task| %>
        <li class="task-item <%= 'done' if task.completed %>">

          <span class="task-title">
            <%= task.completed ? "✔" : "○" %>
            <%= task.title %>
          </span>

          <div class="task-actions">
            <%= form_with model: [@list, task], method: :patch, local: true, class: "inline-form" do |f| %>
              <%= f.submit "Concluir", class: "btn small success" %>
            <% end %>

            <%= form_with model: [@list, task], method: :delete, local: true, class: "inline-form" do |f| %>
              <%= f.submit "Excluir", class: "btn small danger", data: { confirm: "Tem certeza?" } %>
            <% end %>
          </div>

        </li>
      <% end %>
    </ul>

    <%= link_to "Voltar para todas as listas", todo_lists_path, class: "back-link" %>

  </div>
</div>
