<div class="page">
  <div class="card">

    <h1 class="title"><%= @list.title %></h1>

    <% if flash[:notice] %>
      <div class="notice">
        <%= flash[:notice] %>
      </div>
    <% end %>

    <% if flash[:alert] %>
      <div class="alert">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <!-- Formulário para nova tarefa -->
    <%= form_with model: [@list, @task], local: true, class: "task-form" do |f| %>
      <div class="form-group full-width">
        <%= f.label :title, "Nova Tarefa", class: "subtitle" %>

        <% if @task&.errors&.any? %>
          <div class="field-error">
            <%= @task.errors[:title].first %>
          </div>
        <% end %>

        <div class="input-with-button">
          <%= f.text_field :title, class: "input full-width-input", required: true %>
          <%= f.submit "Adicionar", class: "btn primary" %>
        </div>
      </div>
    <% end %>

    <hr>

    <h2 class="subtitle">Minhas Tarefas</h2>

    <div class="task-summary">
      <p>Total: <%= @total_tasks %></p>
      <p>Pendentes: <%= @pending_tasks %></p>
      <p>Concluídas: <%= @completed_tasks %></p>

      <div class="progress-bar">
        <div class="progress-bar-fill" style="width: <%= @progress %>%"></div>
      </div>
      <div class="progress-text">Progresso: <%= @progress %>%</div>
    </div>

    <!-- Lista de tarefas -->
    <ul class="task-list">
      <% @list.tasks.each do |task| %>
        <li class="task-item <%= 'done' if task.completed %>">
          <span class="task-title">
            <%= task.completed ? "✔" : "○" %>
            <%= task.title %>
          </span>

          <div class="task-actions">
            <%= button_to "Concluir", toggle_todo_list_task_path(@list, task), method: :patch, class: "btn small success" %>
            <%= button_to "Excluir", todo_list_task_path(@list, task), method: :delete, class: "btn small danger", data: { confirm: "Tem certeza?" } %>
          </div>
        </li>
      <% end %>
    </ul>

    <%= link_to "Voltar para todas as listas", todo_lists_path, class: "back-link" %>

    <!-- Botão Excluir Lista -->
    <div style="text-align: center;">
      <%= form_with model: @list, method: :delete, local: true do |f| %>
        <%= f.submit "Excluir Lista", class: "back-link-button", data: { confirm: "Tem certeza que deseja excluir a lista?" } %>
      <% end %>
    </div>
  </div>
</div>
